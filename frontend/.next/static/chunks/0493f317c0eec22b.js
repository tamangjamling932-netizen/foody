(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47026,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(9165),l=e.i(54338),r=e.i(5766),i=e.i(92199);let d=["cash","esewa","khalti","bank"];function n(){let{user:e}=(0,l.useAuth)(),[n,c]=(0,t.useState)([]),[o,x]=(0,t.useState)({page:1,limit:10,total:0,pages:1}),[p,m]=(0,t.useState)(!0),[u,h]=(0,t.useState)(""),[g,y]=(0,t.useState)(null),[b,f]=(0,t.useState)({}),[j,N]=(0,t.useState)(null);(0,t.useEffect)(()=>{w()},[o.page,u]);let w=async()=>{m(!0);try{let e={page:o.page,limit:o.limit};"paid"===u&&(e.isPaid="true"),"unpaid"===u&&(e.isPaid="false");let a=await s.default.get("/bills",{params:e});c(a.data.bills||a.data.data||[]),a.data.pagination&&x(a.data.pagination)}catch{r.default.error("Failed to load bills")}finally{m(!1)}},v=async e=>{let a=b[e]||"cash";y(e);try{await s.default.put(`/bills/${e}/pay`,{paymentMethod:a}),c(t=>t.map(t=>t._id===e?{...t,isPaid:!0,paymentMethod:a,paidAt:new Date().toISOString()}:t)),r.default.success("Bill marked as paid")}catch(e){r.default.error(e.response?.data?.message||"Failed to mark bill as paid")}finally{y(null)}},k=async e=>{N(e);try{let a=localStorage.getItem("token"),t=await fetch(`${s.default.defaults.baseURL}/bills/${e}/pdf`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw Error("Failed to download PDF");let l=await t.blob(),i=URL.createObjectURL(l),d=document.createElement("a");d.href=i,d.download=`bill-${e}.pdf`,d.click(),URL.revokeObjectURL(i),r.default.success("PDF downloaded")}catch(e){r.default.error("Failed to download PDF")}finally{N(null)}},P=e=>{switch(e){case"esewa":return"eSewa";case"khalti":return"Khalti";case"bank":return"Bank Transfer";case"cash":return"Cash";default:return e}};return p&&0===n.length?(0,a.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,a.jsx)("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-[#c47a5a] border-t-transparent"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Bills"}),(0,a.jsx)("p",{className:"mt-1 text-gray-500",children:"View and manage billing records"})]}),(0,a.jsx)("div",{className:"flex gap-2",children:[{label:"All",value:""},{label:"Paid",value:"paid"},{label:"Unpaid",value:"unpaid"}].map(e=>(0,a.jsx)("button",{onClick:()=>{h(e.value),x(e=>({...e,page:1}))},className:`rounded-lg px-4 py-2 text-sm font-medium transition-colors ${u===e.value?"bg-[#c47a5a] text-white":"bg-white text-gray-600 shadow-sm hover:bg-gray-50"}`,children:e.label},e.value))}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-xl bg-white shadow-sm",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Bill #"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Order"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Customer"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Total"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Payment"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium text-gray-500",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===n.length?(0,a.jsx)("tr",{children:(0,a.jsxs)("td",{colSpan:8,className:"px-4 py-12 text-center text-gray-400",children:[(0,a.jsx)(i.FiFileText,{className:"mx-auto mb-2 h-10 w-10"}),(0,a.jsx)("p",{children:"No bills found."})]})}):n.map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-50 hover:bg-gray-50/50",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-mono text-xs font-medium text-gray-800",children:e.billNumber}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("span",{className:"font-mono text-xs text-gray-600",children:["#","object"==typeof e.order&&null!==e.order?e.order._id.slice(-6).toUpperCase():String(e.order).slice(-6).toUpperCase()]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-600",children:"object"==typeof e.user&&null!==e.user?e.user.name:"Customer"}),(0,a.jsxs)("td",{className:"px-4 py-3 font-medium text-gray-800",children:["$",e.total.toFixed(2)]}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.isPaid?(0,a.jsx)("span",{className:"inline-block rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600",children:P(e.paymentMethod)}):(0,a.jsx)("select",{value:b[e._id]||"cash",onChange:a=>f(t=>({...t,[e._id]:a.target.value})),className:"rounded-lg border border-gray-200 px-2 py-1 text-xs focus:border-[#c47a5a] focus:outline-none focus:ring-1 focus:ring-[#c47a5a]",children:d.map(e=>(0,a.jsx)("option",{value:e,children:P(e)},e))})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:`inline-block rounded-full px-2.5 py-0.5 text-xs font-medium ${e.isPaid?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:e.isPaid?"Paid":"Unpaid"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[!e.isPaid&&(0,a.jsxs)("button",{onClick:()=>v(e._id),disabled:g===e._id,className:"inline-flex items-center gap-1 rounded-lg bg-green-50 px-3 py-1.5 text-xs font-medium text-green-700 transition-colors hover:bg-green-100 disabled:opacity-50",children:[(0,a.jsx)(i.FiCheck,{className:"h-3.5 w-3.5"}),g===e._id?"Paying...":"Mark Paid"]}),(0,a.jsxs)("button",{onClick:()=>k(e._id),disabled:j===e._id,className:"inline-flex items-center gap-1 rounded-lg bg-[#c47a5a]/10 px-3 py-1.5 text-xs font-medium text-[#c47a5a] transition-colors hover:bg-[#c47a5a]/20 disabled:opacity-50",children:[(0,a.jsx)(i.FiDownload,{className:"h-3.5 w-3.5"}),j===e._id?"...":"PDF"]})]})})]},e._id))})]})}),o.pages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Showing page ",o.page," of ",o.pages," (",o.total," bills)"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>x(e=>({...e,page:e.page-1})),disabled:o.page<=1,className:"rounded-lg border border-gray-200 p-2 text-gray-600 transition-colors hover:bg-gray-50 disabled:opacity-50",children:(0,a.jsx)(i.FiChevronLeft,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>x(e=>({...e,page:e.page+1})),disabled:o.page>=o.pages,className:"rounded-lg border border-gray-200 p-2 text-gray-600 transition-colors hover:bg-gray-50 disabled:opacity-50",children:(0,a.jsx)(i.FiChevronRight,{className:"h-4 w-4"})})]})]})]})}e.s(["default",()=>n])}]);