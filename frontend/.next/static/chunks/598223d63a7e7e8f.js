(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19929,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(18566),l=e.i(9165),r=e.i(5766),i=e.i(57688),d=e.i(22016),n=e.i(92199);let c={pending:"confirmed",confirmed:"preparing",preparing:"served",served:"completed"},o={pending:"bg-yellow-100 text-yellow-700",confirmed:"bg-blue-100 text-blue-700",preparing:"bg-orange-100 text-orange-700",served:"bg-purple-100 text-purple-700",completed:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700"};function m(){let e=(0,t.useParams)();(0,t.useRouter)();let m=e.id,[x,u]=(0,a.useState)(null),[p,h]=(0,a.useState)(null),[f,g]=(0,a.useState)(!0),[b,y]=(0,a.useState)(!1),[j,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)(!1),[F,P]=(0,a.useState)(!1),[S,k]=(0,a.useState)("cash");(0,a.useEffect)(()=>{m&&(async()=>{try{let[e,s]=await Promise.allSettled([l.default.get(`/orders/${m}`),l.default.get(`/bills?order=${m}`)]);if("fulfilled"===e.status&&u(e.value.data.order),"fulfilled"===s.status){let e=s.value.data.bills||[];e.length>0&&h(e[0])}}catch{r.default.error("Failed to load order")}finally{g(!1)}})()},[m]);let C=async e=>{y(!0);try{let s=await l.default.put(`/orders/${m}/status`,{status:e});u(s.data.order),r.default.success(`Order status updated to ${e}`)}catch(e){r.default.error(e.response?.data?.message||"Failed to update status")}finally{y(!1)}},z=async()=>{N(!0);try{let e=await l.default.post(`/bills/${m}`);h(e.data.bill),r.default.success("Bill generated successfully")}catch(e){r.default.error(e.response?.data?.message||"Failed to generate bill")}finally{N(!1)}},$=async()=>{if(p){w(!0);try{let e=await l.default.put(`/bills/${p._id}/pay`,{paymentMethod:S});h(e.data.bill),r.default.success("Bill marked as paid")}catch(e){r.default.error(e.response?.data?.message||"Failed to mark as paid")}finally{w(!1)}}},U=async()=>{if(p){P(!0);try{let e=localStorage.getItem("token"),s=await fetch(`${l.default.defaults.baseURL}/bills/${p._id}/pdf`,{headers:{Authorization:`Bearer ${e}`}}),a=await s.blob(),t=URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download=`bill-${p.billNumber||p._id}.pdf`,r.click(),URL.revokeObjectURL(t)}catch{r.default.error("Failed to download PDF")}finally{P(!1)}}};if(f)return(0,s.jsx)("div",{className:"flex justify-center py-20",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-[var(--primary)]"})});if(!x)return(0,s.jsxs)("div",{className:"text-center py-20",children:[(0,s.jsx)(n.FiAlertCircle,{size:48,className:"mx-auto text-gray-300 mb-4"}),(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Order not found"}),(0,s.jsx)(d.default,{href:"/admin/orders",className:"text-[var(--primary)] hover:underline",children:"Back to Orders"})]});let B=c[x.status],O="object"==typeof x.user&&null!==x.user?x.user.name:"Customer";return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,s.jsx)(d.default,{href:"/admin/orders",className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(n.FiArrowLeft,{size:20})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h1",{className:"text-xl font-bold",children:["Order #",x._id.slice(-6).toUpperCase()]}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:[new Date(x.createdAt).toLocaleString()," • ",O]})]}),(0,s.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-semibold capitalize ${o[x.status]||""}`,children:x.status})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[x.tableNumber&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,s.jsx)(n.FiMapPin,{size:14,className:"text-gray-400"}),"Table ",x.tableNumber]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,s.jsx)(n.FiPackage,{size:14,className:"text-gray-400"}),x.items.reduce((e,s)=>e+s.quantity,0)," items"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,s.jsx)(n.FiDollarSign,{size:14,className:"text-gray-400"}),x.isPaid?(0,s.jsx)("span",{className:"text-green-600 font-medium",children:"Paid"}):(0,s.jsx)("span",{className:"text-yellow-600 font-medium",children:"Unpaid"})]})]}),x.notes&&(0,s.jsxs)("div",{className:"mt-3 p-3 bg-yellow-50 rounded-lg text-sm text-yellow-700",children:[(0,s.jsx)("strong",{children:"Notes:"})," ",x.notes]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,s.jsx)("h3",{className:"font-semibold mb-4",children:"Order Items"}),(0,s.jsx)("div",{className:"space-y-3",children:x.items.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-50 last:border-0 last:pb-0",children:[(0,s.jsx)("div",{className:"w-14 h-14 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:(0,s.jsx)(i.default,{src:(0,l.getImageUrl)(e.image),alt:e.name,width:56,height:56,className:"w-full h-full object-cover",unoptimized:!0})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["₹",e.price.toFixed(2)," × ",e.quantity]})]}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:["₹",(e.price*e.quantity).toFixed(2)]})]},a))})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"Status Management"}),(0,s.jsx)("select",{value:x.status,onChange:e=>C(e.target.value),disabled:b||"cancelled"===x.status||"completed"===x.status,className:"w-full px-3 py-2 rounded-lg border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary)]/20 disabled:opacity-50 mb-3",children:["pending","confirmed","preparing","served","completed","cancelled"].map(e=>(0,s.jsx)("option",{value:e,className:"capitalize",children:e},e))}),B&&"cancelled"!==x.status&&(0,s.jsx)("button",{onClick:()=>C(B),disabled:b,className:"w-full py-2 bg-[var(--primary)] text-white rounded-lg text-sm font-medium hover:opacity-90 disabled:opacity-50 transition-opacity",children:b?"Updating...":`Advance to ${B}`})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"Summary"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Subtotal"}),(0,s.jsxs)("span",{children:["₹",x.subtotal.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Tax (5%)"}),(0,s.jsxs)("span",{children:["₹",x.tax.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"border-t pt-2 flex justify-between font-bold text-base",children:[(0,s.jsx)("span",{children:"Total"}),(0,s.jsxs)("span",{className:"text-[var(--primary)]",children:["₹",x.total.toFixed(2)]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,s.jsxs)("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[(0,s.jsx)(n.FiFileText,{size:16}),"Billing"]}),p?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"text-sm space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Bill #"}),(0,s.jsx)("span",{className:"font-medium",children:p.billNumber})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Status"}),(0,s.jsx)("span",{className:`font-medium capitalize ${p.isPaid?"text-green-600":"requested"===p.status?"text-yellow-600":"text-gray-600"}`,children:p.isPaid?"Paid":p.status||"Generated"})]}),p.isPaid&&p.paymentMethod&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Payment"}),(0,s.jsx)("span",{className:"font-medium uppercase",children:p.paymentMethod})]}),p.callWaiter&&(0,s.jsx)("div",{className:"p-2 bg-yellow-50 rounded text-xs text-yellow-700",children:"Customer requested waiter assistance"})]}),(0,s.jsxs)("button",{onClick:U,disabled:F,className:"w-full flex items-center justify-center gap-2 py-2 border border-[var(--primary)] text-[var(--primary)] rounded-lg text-sm font-medium hover:bg-[var(--primary)]/5 disabled:opacity-50",children:[(0,s.jsx)(n.FiDownload,{size:14}),F?"Downloading...":"Download PDF"]}),!p.isPaid&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("select",{value:S,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary)]/20",children:[(0,s.jsx)("option",{value:"cash",children:"Cash"}),(0,s.jsx)("option",{value:"esewa",children:"eSewa"}),(0,s.jsx)("option",{value:"khalti",children:"Khalti"}),(0,s.jsx)("option",{value:"bank",children:"Bank Transfer"})]}),(0,s.jsxs)("button",{onClick:$,disabled:v,className:"w-full flex items-center justify-center gap-2 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 disabled:opacity-50",children:[(0,s.jsx)(n.FiCheck,{size:14}),v?"Processing...":"Mark as Paid"]})]})]}):(0,s.jsx)("button",{onClick:z,disabled:j,className:"w-full py-2 bg-[var(--primary)] text-white rounded-lg text-sm font-medium hover:opacity-90 disabled:opacity-50 transition-opacity",children:j?"Generating...":"Generate Bill"})]})]})]})]})}e.s(["default",()=>m])}]);