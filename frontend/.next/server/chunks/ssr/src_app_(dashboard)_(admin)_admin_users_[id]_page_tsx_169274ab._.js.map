{"version":3,"sources":["../../../../src/app/%28dashboard%29/%28admin%29/admin/users/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport API from \"@/lib/api\";\nimport { getImageUrl } from \"@/lib/api\";\nimport { User, Order } from \"@/types\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport toast from \"react-hot-toast\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport {\n  FiArrowLeft,\n  FiMail,\n  FiCalendar,\n  FiShield,\n  FiPackage,\n  FiUser,\n} from \"react-icons/fi\";\n\nconst ROLES = [\"customer\", \"staff\", \"admin\"] as const;\n\nconst roleColor = (role: string) => {\n  switch (role) {\n    case \"admin\":\n      return \"bg-red-100 text-red-700\";\n    case \"staff\":\n      return \"bg-blue-100 text-blue-700\";\n    case \"customer\":\n      return \"bg-gray-100 text-gray-600\";\n    default:\n      return \"bg-gray-100 text-gray-600\";\n  }\n};\n\nconst statusColor = (status: string) => {\n  switch (status) {\n    case \"pending\":\n      return \"bg-yellow-100 text-yellow-700\";\n    case \"confirmed\":\n      return \"bg-blue-100 text-blue-700\";\n    case \"preparing\":\n      return \"bg-orange-100 text-orange-700\";\n    case \"served\":\n      return \"bg-purple-100 text-purple-700\";\n    case \"completed\":\n      return \"bg-green-100 text-green-700\";\n    case \"cancelled\":\n      return \"bg-red-100 text-red-700\";\n    default:\n      return \"bg-gray-100 text-gray-600\";\n  }\n};\n\nexport default function AdminUserDetailPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { user: currentUser } = useAuth();\n  const userId = params.id as string;\n\n  const [user, setUser] = useState<User | null>(null);\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const [updatingRole, setUpdatingRole] = useState(false);\n\n  useEffect(() => {\n    if (!userId) return;\n    fetchUserData();\n  }, [userId]);\n\n  const fetchUserData = async () => {\n    setLoading(true);\n    setError(\"\");\n    try {\n      const [userRes, ordersRes] = await Promise.all([\n        API.get(`/users/${userId}`),\n        API.get(`/users/${userId}/orders`).catch(() => ({ data: { orders: [] } })),\n      ]);\n      setUser(userRes.data.user || userRes.data);\n      setOrders(ordersRes.data.orders || ordersRes.data || []);\n    } catch (err: any) {\n      setError(err.response?.data?.message || \"Failed to load user details\");\n      toast.error(\"Failed to load user details\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRoleChange = async (newRole: string) => {\n    if (!user) return;\n    if (user._id === currentUser?._id) {\n      toast.error(\"You cannot change your own role\");\n      return;\n    }\n    setUpdatingRole(true);\n    try {\n      await API.put(`/users/${userId}/role`, { role: newRole });\n      setUser((prev) => (prev ? { ...prev, role: newRole as User[\"role\"] } : prev));\n      toast.success(`Role updated to ${newRole}`);\n    } catch (err: any) {\n      toast.error(err.response?.data?.message || \"Failed to update role\");\n    } finally {\n      setUpdatingRole(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-20\">\n        <div className=\"h-10 w-10 animate-spin rounded-full border-4 border-[#c47a5a] border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (error || !user) {\n    return (\n      <div className=\"space-y-4 py-20 text-center\">\n        <p className=\"text-gray-500\">{error || \"User not found\"}</p>\n        <Link\n          href=\"/admin/users\"\n          className=\"inline-flex items-center gap-2 text-sm text-[#c47a5a] hover:underline\"\n        >\n          <FiArrowLeft className=\"h-4 w-4\" />\n          Back to Users\n        </Link>\n      </div>\n    );\n  }\n\n  const isSelf = user._id === currentUser?._id;\n  const initials = user.name\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Back Link */}\n      <Link\n        href=\"/admin/users\"\n        className=\"inline-flex items-center gap-2 text-sm text-gray-500 hover:text-[#c47a5a] transition-colors\"\n      >\n        <FiArrowLeft className=\"h-4 w-4\" />\n        Back to Users\n      </Link>\n\n      {/* User Info Card */}\n      <div className=\"rounded-xl bg-white p-6 shadow-sm\">\n        <div className=\"flex flex-col gap-6 sm:flex-row sm:items-start\">\n          {/* Avatar */}\n          <div className=\"flex-shrink-0\">\n            {user.avatar ? (\n              <Image\n                src={getImageUrl(user.avatar)}\n                alt={user.name}\n                width={80}\n                height={80}\n                className=\"h-20 w-20 rounded-full object-cover\"\n              />\n            ) : (\n              <div className=\"flex h-20 w-20 items-center justify-center rounded-full bg-[#c47a5a]/10 text-2xl font-bold text-[#c47a5a]\">\n                {initials}\n              </div>\n            )}\n          </div>\n\n          {/* Details */}\n          <div className=\"flex-1 space-y-3\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-800\">\n                {user.name}\n                {isSelf && (\n                  <span className=\"ml-2 text-sm font-normal text-gray-400\">(you)</span>\n                )}\n              </h1>\n            </div>\n\n            <div className=\"flex flex-wrap gap-4 text-sm text-gray-500\">\n              <div className=\"flex items-center gap-1.5\">\n                <FiMail className=\"h-4 w-4\" />\n                {user.email}\n              </div>\n              <div className=\"flex items-center gap-1.5\">\n                <FiCalendar className=\"h-4 w-4\" />\n                Joined {new Date(user.createdAt).toLocaleDateString()}\n              </div>\n            </div>\n\n            {/* Role Management */}\n            <div className=\"flex items-center gap-3\">\n              <FiShield className=\"h-4 w-4 text-gray-400\" />\n              {isSelf ? (\n                <span\n                  className={`inline-block rounded-full px-3 py-1 text-xs font-medium capitalize ${roleColor(user.role)}`}\n                >\n                  {user.role}\n                </span>\n              ) : (\n                <select\n                  value={user.role}\n                  onChange={(e) => handleRoleChange(e.target.value)}\n                  disabled={updatingRole}\n                  className={`rounded-full px-3 py-1 text-xs font-medium capitalize ${roleColor(user.role)} cursor-pointer border-none focus:outline-none focus:ring-2 focus:ring-[#c47a5a] disabled:opacity-50`}\n                >\n                  {ROLES.map((r) => (\n                    <option key={r} value={r}>\n                      {r}\n                    </option>\n                  ))}\n                </select>\n              )}\n              {updatingRole && (\n                <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-[#c47a5a] border-t-transparent\" />\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Order History */}\n      <div className=\"rounded-xl bg-white shadow-sm\">\n        <div className=\"border-b border-gray-100 px-6 py-4\">\n          <h2 className=\"flex items-center gap-2 text-lg font-semibold text-gray-800\">\n            <FiPackage className=\"h-5 w-5 text-[#c47a5a]\" />\n            Order History\n            <span className=\"ml-1 text-sm font-normal text-gray-400\">\n              ({orders.length})\n            </span>\n          </h2>\n        </div>\n\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left text-sm\">\n            <thead>\n              <tr className=\"border-b border-gray-100\">\n                <th className=\"px-6 py-3 font-medium text-gray-500\">Order ID</th>\n                <th className=\"px-6 py-3 font-medium text-gray-500\">Items</th>\n                <th className=\"px-6 py-3 font-medium text-gray-500\">Total</th>\n                <th className=\"px-6 py-3 font-medium text-gray-500\">Status</th>\n                <th className=\"px-6 py-3 font-medium text-gray-500\">Date</th>\n              </tr>\n            </thead>\n            <tbody>\n              {orders.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"px-6 py-12 text-center text-gray-400\">\n                    <FiPackage className=\"mx-auto mb-2 h-10 w-10\" />\n                    <p>No orders found for this user.</p>\n                  </td>\n                </tr>\n              ) : (\n                orders.map((order) => (\n                  <tr\n                    key={order._id}\n                    className=\"border-b border-gray-50 hover:bg-gray-50/50\"\n                  >\n                    <td className=\"px-6 py-3 font-mono text-xs text-gray-600\">\n                      {order._id.slice(-8).toUpperCase()}\n                    </td>\n                    <td className=\"px-6 py-3 text-gray-600\">\n                      {order.items.length} item{order.items.length !== 1 && \"s\"}\n                    </td>\n                    <td className=\"px-6 py-3 font-medium text-gray-800\">\n                      ${order.total.toFixed(2)}\n                    </td>\n                    <td className=\"px-6 py-3\">\n                      <span\n                        className={`inline-block rounded-full px-2.5 py-0.5 text-xs font-medium capitalize ${statusColor(order.status)}`}\n                      >\n                        {order.status}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-3 text-xs text-gray-500\">\n                      {new Date(order.createdAt).toLocaleDateString()}\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}