module.exports=[88985,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(19032),f=a.i(6704),g=a.i(71987),h=a.i(38246),i=a.i(27348);let j={pending:"confirmed",confirmed:"preparing",preparing:"served",served:"completed"},k={pending:"bg-yellow-100 text-yellow-700",confirmed:"bg-blue-100 text-blue-700",preparing:"bg-orange-100 text-orange-700",served:"bg-purple-100 text-purple-700",completed:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700"};function l(){let a=(0,d.useParams)();(0,d.useRouter)();let l=a.id,[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)("cash");(0,c.useEffect)(()=>{l&&(async()=>{try{let[a,b]=await Promise.allSettled([e.default.get(`/orders/${l}`),e.default.get(`/bills?order=${l}`)]);if("fulfilled"===a.status&&n(a.value.data.order),"fulfilled"===b.status){let a=b.value.data.bills||[];a.length>0&&p(a[0])}}catch{f.default.error("Failed to load order")}finally{r(!1)}})()},[l]);let C=async a=>{t(!0);try{let b=await e.default.put(`/orders/${l}/status`,{status:a});n(b.data.order),f.default.success(`Order status updated to ${a}`)}catch(a){f.default.error(a.response?.data?.message||"Failed to update status")}finally{t(!1)}},D=async()=>{v(!0);try{let a=await e.default.post(`/bills/${l}`);p(a.data.bill),f.default.success("Bill generated successfully")}catch(a){f.default.error(a.response?.data?.message||"Failed to generate bill")}finally{v(!1)}},E=async()=>{if(o){x(!0);try{let a=await e.default.put(`/bills/${o._id}/pay`,{paymentMethod:A});p(a.data.bill),f.default.success("Bill marked as paid")}catch(a){f.default.error(a.response?.data?.message||"Failed to mark as paid")}finally{x(!1)}}},F=async()=>{if(o){z(!0);try{let a=localStorage.getItem("token"),b=await fetch(`${e.default.defaults.baseURL}/bills/${o._id}/pdf`,{headers:{Authorization:`Bearer ${a}`}}),c=await b.blob(),d=URL.createObjectURL(c),f=document.createElement("a");f.href=d,f.download=`bill-${o.billNumber||o._id}.pdf`,f.click(),URL.revokeObjectURL(d)}catch{f.default.error("Failed to download PDF")}finally{z(!1)}}};if(q)return(0,b.jsx)("div",{className:"flex justify-center py-20",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-[var(--primary)]"})});if(!m)return(0,b.jsxs)("div",{className:"text-center py-20",children:[(0,b.jsx)(i.FiAlertCircle,{size:48,className:"mx-auto text-gray-300 mb-4"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Order not found"}),(0,b.jsx)(h.default,{href:"/admin/orders",className:"text-[var(--primary)] hover:underline",children:"Back to Orders"})]});let G=j[m.status],H="object"==typeof m.user&&null!==m.user?m.user.name:"Customer";return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,b.jsx)(h.default,{href:"/admin/orders",className:"text-gray-400 hover:text-gray-600",children:(0,b.jsx)(i.FiArrowLeft,{size:20})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("h1",{className:"text-xl font-bold",children:["Order #",m._id.slice(-6).toUpperCase()]}),(0,b.jsxs)("p",{className:"text-sm text-gray-400",children:[new Date(m.createdAt).toLocaleString()," • ",H]})]}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-semibold capitalize ${k[m.status]||""}`,children:m.status})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[m.tableNumber&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(i.FiMapPin,{size:14,className:"text-gray-400"}),"Table ",m.tableNumber]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(i.FiPackage,{size:14,className:"text-gray-400"}),m.items.reduce((a,b)=>a+b.quantity,0)," items"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(i.FiDollarSign,{size:14,className:"text-gray-400"}),m.isPaid?(0,b.jsx)("span",{className:"text-green-600 font-medium",children:"Paid"}):(0,b.jsx)("span",{className:"text-yellow-600 font-medium",children:"Unpaid"})]})]}),m.notes&&(0,b.jsxs)("div",{className:"mt-3 p-3 bg-yellow-50 rounded-lg text-sm text-yellow-700",children:[(0,b.jsx)("strong",{children:"Notes:"})," ",m.notes]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4",children:"Order Items"}),(0,b.jsx)("div",{className:"space-y-3",children:m.items.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-3 pb-3 border-b border-gray-50 last:border-0 last:pb-0",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:(0,b.jsx)(g.default,{src:(0,e.getImageUrl)(a.image),alt:a.name,width:56,height:56,className:"w-full h-full object-cover",unoptimized:!0})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:["₹",a.price.toFixed(2)," × ",a.quantity]})]}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:["₹",(a.price*a.quantity).toFixed(2)]})]},c))})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Status Management"}),(0,b.jsx)("select",{value:m.status,onChange:a=>C(a.target.value),disabled:s||"cancelled"===m.status||"completed"===m.status,className:"w-full px-3 py-2 rounded-lg border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary)]/20 disabled:opacity-50 mb-3",children:["pending","confirmed","preparing","served","completed","cancelled"].map(a=>(0,b.jsx)("option",{value:a,className:"capitalize",children:a},a))}),G&&"cancelled"!==m.status&&(0,b.jsx)("button",{onClick:()=>C(G),disabled:s,className:"w-full py-2 bg-[var(--primary)] text-white rounded-lg text-sm font-medium hover:opacity-90 disabled:opacity-50 transition-opacity",children:s?"Updating...":`Advance to ${G}`})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"Summary"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Subtotal"}),(0,b.jsxs)("span",{children:["₹",m.subtotal.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Tax (5%)"}),(0,b.jsxs)("span",{children:["₹",m.tax.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"border-t pt-2 flex justify-between font-bold text-base",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{className:"text-[var(--primary)]",children:["₹",m.total.toFixed(2)]})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5",children:[(0,b.jsxs)("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(i.FiFileText,{size:16}),"Billing"]}),o?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"text-sm space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Bill #"}),(0,b.jsx)("span",{className:"font-medium",children:o.billNumber})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Status"}),(0,b.jsx)("span",{className:`font-medium capitalize ${o.isPaid?"text-green-600":"requested"===o.status?"text-yellow-600":"text-gray-600"}`,children:o.isPaid?"Paid":o.status||"Generated"})]}),o.isPaid&&o.paymentMethod&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Payment"}),(0,b.jsx)("span",{className:"font-medium uppercase",children:o.paymentMethod})]}),o.callWaiter&&(0,b.jsx)("div",{className:"p-2 bg-yellow-50 rounded text-xs text-yellow-700",children:"Customer requested waiter assistance"})]}),(0,b.jsxs)("button",{onClick:F,disabled:y,className:"w-full flex items-center justify-center gap-2 py-2 border border-[var(--primary)] text-[var(--primary)] rounded-lg text-sm font-medium hover:bg-[var(--primary)]/5 disabled:opacity-50",children:[(0,b.jsx)(i.FiDownload,{size:14}),y?"Downloading...":"Download PDF"]}),!o.isPaid&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("select",{value:A,onChange:a=>B(a.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary)]/20",children:[(0,b.jsx)("option",{value:"cash",children:"Cash"}),(0,b.jsx)("option",{value:"esewa",children:"eSewa"}),(0,b.jsx)("option",{value:"khalti",children:"Khalti"}),(0,b.jsx)("option",{value:"bank",children:"Bank Transfer"})]}),(0,b.jsxs)("button",{onClick:E,disabled:w,className:"w-full flex items-center justify-center gap-2 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 disabled:opacity-50",children:[(0,b.jsx)(i.FiCheck,{size:14}),w?"Processing...":"Mark as Paid"]})]})]}):(0,b.jsx)("button",{onClick:D,disabled:u,className:"w-full py-2 bg-[var(--primary)] text-white rounded-lg text-sm font-medium hover:opacity-90 disabled:opacity-50 transition-opacity",children:u?"Generating...":"Generate Bill"})]})]})]})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=src_app_%28dashboard%29_%28admin%29_admin_orders_%5Bid%5D_page_tsx_715320b4._.js.map