{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/trish/Documents/joseph/foody/frontend/src/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\n\nfunction decodeJwtPayload(token: string): { id: string; role: string } | null {\n  try {\n    const payload = token.split(\".\")[1];\n    const decoded = JSON.parse(Buffer.from(payload, \"base64\").toString());\n    return decoded;\n  } catch {\n    return null;\n  }\n}\n\nconst AUTH_PAGES = [\"/login\", \"/signup\", \"/forgot-password\", \"/reset-password\"];\n\nexport function proxy(request: NextRequest) {\n  const token = request.cookies.get(\"token\")?.value;\n  const { pathname } = request.nextUrl;\n  const payload = token ? decodeJwtPayload(token) : null;\n  const isAuthenticated = !!payload;\n  const role = payload?.role;\n\n  // Auth pages: redirect away if already logged in\n  if (AUTH_PAGES.some((page) => pathname.startsWith(page))) {\n    if (isAuthenticated) {\n      const dest = role === \"admin\" || role === \"staff\" ? \"/admin\" : \"/menu\";\n      return NextResponse.redirect(new URL(dest, request.url));\n    }\n    return NextResponse.next();\n  }\n\n  // Admin routes: require admin or staff\n  if (pathname.startsWith(\"/admin\")) {\n    if (!isAuthenticated) {\n      return NextResponse.redirect(new URL(\"/login\", request.url));\n    }\n    if (role !== \"admin\" && role !== \"staff\") {\n      return NextResponse.redirect(new URL(\"/menu\", request.url));\n    }\n    return NextResponse.next();\n  }\n\n  // Protected customer pages\n  if ([\"/dashboard\", \"/menu\", \"/cart\", \"/orders\", \"/profile\"].some((p) => pathname.startsWith(p))) {\n    if (!isAuthenticated) {\n      return NextResponse.redirect(new URL(\"/login\", request.url));\n    }\n    return NextResponse.next();\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    \"/login\",\n    \"/signup\",\n    \"/forgot-password\",\n    \"/reset-password/:path*\",\n    \"/admin/:path*\",\n    \"/dashboard/:path*\",\n    \"/menu/:path*\",\n    \"/cart/:path*\",\n    \"/orders/:path*\",\n    \"/profile/:path*\",\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,SAAS,iBAAiB,KAAa;IACrC,IAAI;QACF,MAAM,UAAU,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;QACnC,MAAM,UAAU,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,SAAS,UAAU,QAAQ;QAClE,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEA,MAAM,aAAa;IAAC;IAAU;IAAW;IAAoB;CAAkB;AAExE,SAAS,MAAM,OAAoB;IACxC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAC5C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,UAAU,QAAQ,iBAAiB,SAAS;IAClD,MAAM,kBAAkB,CAAC,CAAC;IAC1B,MAAM,OAAO,SAAS;IAEtB,iDAAiD;IACjD,IAAI,WAAW,IAAI,CAAC,CAAC,OAAS,SAAS,UAAU,CAAC,QAAQ;QACxD,IAAI,iBAAiB;YACnB,MAAM,OAAO,SAAS,WAAW,SAAS,UAAU,WAAW;YAC/D,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,MAAM,QAAQ,GAAG;QACxD;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,uCAAuC;IACvC,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,iBAAiB;YACpB,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,IAAI,SAAS,WAAW,SAAS,SAAS;YACxC,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,SAAS,QAAQ,GAAG;QAC3D;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,2BAA2B;IAC3B,IAAI;QAAC;QAAc;QAAS;QAAS;QAAW;KAAW,CAAC,IAAI,CAAC,CAAC,IAAM,SAAS,UAAU,CAAC,KAAK;QAC/F,IAAI,CAAC,iBAAiB;YACpB,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH"}}]
}